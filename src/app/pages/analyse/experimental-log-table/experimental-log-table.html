<section aria-label="Experimental log table" class="experimental-log-table">
  <div class="toolbar">
    <label class="visually-hidden" for="log-search">Search logs</label>
    <mat-form-field appearance="outline" class="search-field">
      <input
        [formControl]="search"
        aria-label="Search logs"
        id="log-search"
        matInput
        placeholder="Search logs (message, kind, meta...)"
      />
      @if (search.value) {
        <button (click)="search.setValue('')" aria-label="Clear search" mat-icon-button matSuffix type="button">
          <mat-icon>close</mat-icon>
        </button>
      }
    </mat-form-field>

    <div aria-live="polite" class="counts">
      @if (matchedCount() < totalCount()) {
        <span>Showing {{ matchedCount() }} of {{ totalCount() }} entries</span>
      } @else {
        <span>{{ totalCount() }} entries</span>
      }
    </div>
  </div>

  @if (totalCount() === 0) {
    <div class="empty" role="status">No parsed entries yet. Start parsing a log file to see entries here.</div>
  } @else {
    <div class="table-wrapper">
      <table aria-label="Parsed log entries - headers" class="log-table" mat-table matSort>
        <ng-container matColumnDef="timestamp">
          <th *matHeaderCellDef mat-header-cell mat-sort-header="timestamp">Timestamp</th>
        </ng-container>

        <ng-container matColumnDef="level">
          <th *matHeaderCellDef mat-header-cell mat-sort-header="level">Level</th>
        </ng-container>

        <ng-container matColumnDef="environment">
          <th *matHeaderCellDef mat-header-cell mat-sort-header="environment">Env</th>
        </ng-container>

        <ng-container matColumnDef="kind">
          <th *matHeaderCellDef mat-header-cell mat-sort-header="kind">Kind</th>
        </ng-container>

        <ng-container matColumnDef="message">
          <th *matHeaderCellDef mat-header-cell mat-sort-header="message">Message</th>
        </ng-container>

        <tr *matHeaderRowDef="columns" mat-header-row></tr>
      </table>

      <cdk-virtual-scroll-viewport class="viewport" itemSize="48">
        <table aria-label="Parsed log entries - rows" class="log-table" role="table">
          <tbody>
            <tr *cdkVirtualFor="let row of paginatedEntries(); let i = index" tabindex="0">
              <td>{{ formatTimestamp(row) }}</td>
              <td>{{ formatLevel(row) }}</td>
              <td>{{ formatEnvironment(row) }}</td>
              <td>{{ row.kind }}</td>
              <td>{{ getMessagePreview(row) }}</td>
            </tr>
          </tbody>
        </table>
      </cdk-virtual-scroll-viewport>

      <mat-paginator
        [length]="filteredEntries().length"
        [pageIndex]="pageIndex()"
        [pageSizeOptions]="[25, 50, 100, 200]"
        [pageSize]="pageSize()"
      ></mat-paginator>
    </div>
  }
</section>
