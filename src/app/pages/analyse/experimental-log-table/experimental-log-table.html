<section aria-label="Experimental log table" class="experimental-log-table">
	<div class="toolbar">
		<label class="visually-hidden" for="log-search">Search logs</label>
		<mat-form-field appearance="outline" class="search-field">
			<input
						[formControl]="search"
						aria-label="Search logs"
						id="log-search"
						matInput
						placeholder="Search logs (message, kind, meta...)"
			/>
			@if (search.value) {
				<button (click)="search.setValue('')" aria-label="Clear search" mat-icon-button matSuffix type="button">
					<mat-icon>close</mat-icon>
				</button>
			}
		</mat-form-field>

		<div aria-live="polite" class="counts">
			@if (dataSource.filteredData.length < dataSource.data.length) {
				<span>Showing {{ dataSource.filteredData.length }} of {{ dataSource.data.length }} entries</span>
			} @else {
				<span>{{ dataSource.data.length }} entries</span>
			}
		</div>
	</div>

	@if (dataSource.data.length === 0) {
		<div class="empty" role="status">No parsed entries yet. Start parsing a log file to see entries here.</div>
	} @else {
		@if (useVirtual) {
			<div class="table-container virtual">
				<div class="mat-table-headers sticky-headers">
					<div class="mat-header-row">
						<div class="mat-header-cell">Timestamp</div>
						<div class="mat-header-cell small">Level</div>
						<div class="mat-header-cell small">Env</div>
						<div class="mat-header-cell small">Kind</div>
						<div class="mat-header-cell message">Message</div>
					</div>
				</div>

				<cdk-virtual-scroll-viewport aria-label="Log entries list" class="viewport" itemSize="48" role="list">
					<div class="rows" role="table">
						<div *cdkVirtualFor="let row of virtualRows; trackBy: trackByEntry" class="row" role="row" tabindex="0">
							<div class="cell">{{ formatTimestamp(row) | date: 'medium' }}</div>
							<div class="cell small">{{ formatLevel(row) }}</div>
							<div class="cell small">{{ formatEnvironment(row) }}</div>
							<div class="cell small">{{ row.kind }}</div>
							<div [innerHTML]="getHighlightedMessage(row)" class="cell message"></div>
						</div>
					</div>
				</cdk-virtual-scroll-viewport>
			</div>
		} @else {
			<div class="table-container">
				<table [dataSource]="dataSource" aria-label="Parsed log entries table" class="mat-elevation-z1" mat-table matSort>

					<ng-container matColumnDef="timestamp">
						<th *matHeaderCellDef mat-header-cell mat-sort-header>Timestamp</th>
						<td *matCellDef="let row" mat-cell>{{ formatTimestamp(row) | date: 'medium' }}</td>
					</ng-container>

					<ng-container matColumnDef="level">
						<th *matHeaderCellDef mat-header-cell mat-sort-header>Level</th>
						<td *matCellDef="let row" mat-cell>{{ formatLevel(row) }}</td>
					</ng-container>

					<ng-container matColumnDef="environment">
						<th *matHeaderCellDef mat-header-cell mat-sort-header>Env</th>
						<td *matCellDef="let row" mat-cell>{{ formatEnvironment(row) }}</td>
					</ng-container>

					<ng-container matColumnDef="kind">
						<th *matHeaderCellDef mat-header-cell mat-sort-header>Kind</th>
						<td *matCellDef="let row" mat-cell>{{ row.kind }}</td>
					</ng-container>

					<ng-container matColumnDef="message">
						<th *matHeaderCellDef mat-header-cell mat-sort-header>Message</th>
						<td *matCellDef="let row" [innerHTML]="getHighlightedMessage(row)" [title]="getMessagePreview(row)" mat-cell></td>
					</ng-container>

					<tr *matHeaderRowDef="displayedColumns" class="sticky" mat-header-row></tr>
					<tr *matRowDef="let row; columns: displayedColumns" mat-row tabindex="0"></tr>
				</table>

				<mat-paginator
							[length]="dataSource.filteredData.length"
							[pageSizeOptions]="[25, 50, 100]"
							[pageSize]="50"
				></mat-paginator>
			</div>
		}
	}
</section>
