<div class="query-help-dialog">
  <div class="dialog-header">
    <h2 mat-dialog-title>Query Syntax Reference</h2>
    <button mat-icon-button (click)="close()" aria-label="Close dialog">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <mat-dialog-content>
    <mat-tab-group>
      <!-- Quick Start Tab -->
      <mat-tab label="Quick Start">
        <div class="tab-content">
          <h3>Basic Queries</h3>
          <p>Search logs using field-specific queries with operators and functions.</p>

          <div class="example-group">
            <h4>Field Comparisons</h4>
            <code>level=error</code>
            <p class="description">Exact match on log level</p>

            <code>statusCode&gt;500</code>
            <p class="description">Numeric comparison</p>

            <code>timestamp&gt;="2024-12-01"</code>
            <p class="description">Date/time range filtering</p>
          </div>

          <div class="example-group">
            <h4>String Functions</h4>
            <code>message.contains(timeout)</code>
            <p class="description">Check if message contains text</p>

            <code>hostname.startsWith(web)</code>
            <p class="description">Check if field starts with text</p>

            <code>line.endsWith(failed)</code>
            <p class="description">Check if field ends with text</p>
          </div>

          <div class="example-group">
            <h4>Boolean Logic</h4>
            <code>level=error AND message.contains(api)</code>
            <p class="description">Combine multiple conditions</p>

            <code>level=error OR level=fatal</code>
            <p class="description">Match either condition</p>

            <code>NOT level=debug</code>
            <p class="description">Exclude matches</p>
          </div>
        </div>
      </mat-tab>

      <!-- Operators Tab -->
      <mat-tab label="Operators">
        <div class="tab-content">
          <h3>Comparison Operators</h3>
          <table class="operators-table">
            <thead>
              <tr>
                <th>Operator</th>
                <th>Description</th>
                <th>Example</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>=</code></td>
                <td>Equal to</td>
                <td><code>level=error</code></td>
              </tr>
              <tr>
                <td><code>!=</code></td>
                <td>Not equal to</td>
                <td><code>level!=debug</code></td>
              </tr>
              <tr>
                <td><code>&gt;</code></td>
                <td>Greater than</td>
                <td><code>statusCode&gt;500</code></td>
              </tr>
              <tr>
                <td><code>&gt;=</code></td>
                <td>Greater than or equal</td>
                <td><code>statusCode&gt;=400</code></td>
              </tr>
              <tr>
                <td><code>&lt;</code></td>
                <td>Less than</td>
                <td><code>statusCode&lt;400</code></td>
              </tr>
              <tr>
                <td><code>&lt;=</code></td>
                <td>Less than or equal</td>
                <td><code>statusCode&lt;=299</code></td>
              </tr>
            </tbody>
          </table>

          <h3>Boolean Operators</h3>
          <table class="operators-table">
            <thead>
              <tr>
                <th>Operator</th>
                <th>Description</th>
                <th>Example</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>AND</code></td>
                <td>Both conditions must be true</td>
                <td><code>level=error AND environment=prod</code></td>
              </tr>
              <tr>
                <td><code>OR</code></td>
                <td>Either condition must be true</td>
                <td><code>level=error OR level=fatal</code></td>
              </tr>
              <tr>
                <td><code>NOT</code></td>
                <td>Negates the condition</td>
                <td><code>NOT level=debug</code></td>
              </tr>
              <tr>
                <td><code>( )</code></td>
                <td>Group expressions</td>
                <td><code>(level=error OR level=fatal) AND environment=prod</code></td>
              </tr>
            </tbody>
          </table>
        </div>
      </mat-tab>

      <!-- Functions Tab -->
      <mat-tab label="Functions">
        <div class="tab-content">
          <h3>String Functions</h3>

          <div class="function-group">
            <h4>contains(text)</h4>
            <p>Check if a field contains the specified text (case-insensitive).</p>
            <div class="examples">
              <code>message.contains(timeout)</code>
              <code>message.contains("connection error")</code>
              <code>hostname.contains(api)</code>
            </div>
          </div>

          <div class="function-group">
            <h4>startsWith(text)</h4>
            <p>Check if a field starts with the specified text.</p>
            <div class="examples">
              <code>hostname.startsWith(web)</code>
              <code>message.startsWith(ERROR)</code>
              <code>url.startsWith("/api")</code>
            </div>
          </div>

          <div class="function-group">
            <h4>endsWith(text)</h4>
            <p>Check if a field ends with the specified text.</p>
            <div class="examples">
              <code>message.endsWith(failed)</code>
              <code>url.endsWith(".json")</code>
              <code>hostname.endsWith(".local")</code>
            </div>
          </div>

          <div class="function-group">
            <h4>matches(regex)</h4>
            <p>Match a field against a regular expression pattern.</p>
            <div class="examples">
              <code>message.matches(/timeout/i)</code>
              <code>message.matches(/\d{3}\s+error/)</code>
              <code>message.matches(/^ERROR.*timeout$/)</code>
              <code>message.matches(/api|database|connection/)</code>
            </div>
            <p class="note">
              <strong>Note:</strong> Use <code>/pattern/flags</code> syntax. Common flags: <code>i</code> (case-insensitive),
              <code>g</code> (global).
            </p>
          </div>
        </div>
      </mat-tab>

      <!-- Available Fields Tab -->
      <mat-tab label="Available Fields">
        <div class="tab-content">
          <h3>Common Fields (All Formats)</h3>
          <table class="fields-table">
            <thead>
              <tr>
                <th>Field</th>
                <th>Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>level</code></td>
                <td>string</td>
                <td>Log level (trace, debug, info, warn, error, fatal, unknown)</td>
              </tr>
              <tr>
                <td><code>message</code></td>
                <td>string</td>
                <td>Log message text</td>
              </tr>
              <tr>
                <td><code>timestamp</code></td>
                <td>date</td>
                <td>Log timestamp</td>
              </tr>
              <tr>
                <td><code>environment</code></td>
                <td>string</td>
                <td>Environment (dev, staging, prod, unknown)</td>
              </tr>
              <tr>
                <td><code>kind</code></td>
                <td>string</td>
                <td>Log format type</td>
              </tr>
            </tbody>
          </table>

          <h3>Pino Log Format</h3>
          <table class="fields-table">
            <thead>
              <tr>
                <th>Field</th>
                <th>Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>msg</code></td>
                <td>string</td>
                <td>Message (alias for message)</td>
              </tr>
              <tr>
                <td><code>hostname</code></td>
                <td>string</td>
                <td>Host name</td>
              </tr>
              <tr>
                <td><code>pid</code></td>
                <td>number</td>
                <td>Process ID</td>
              </tr>
              <tr>
                <td><code>name</code></td>
                <td>string</td>
                <td>Logger name</td>
              </tr>
              <tr>
                <td><code>time</code></td>
                <td>number</td>
                <td>Timestamp in milliseconds</td>
              </tr>
              <tr>
                <td><code>statusCode</code></td>
                <td>number</td>
                <td>HTTP status code (if available)</td>
              </tr>
              <tr>
                <td><code>method</code></td>
                <td>string</td>
                <td>HTTP method (if available)</td>
              </tr>
              <tr>
                <td><code>url</code></td>
                <td>string</td>
                <td>Request URL (if available)</td>
              </tr>
            </tbody>
          </table>

          <h3>Winston Log Format</h3>
          <table class="fields-table">
            <thead>
              <tr>
                <th>Field</th>
                <th>Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>level</code></td>
                <td>string</td>
                <td>Log level</td>
              </tr>
              <tr>
                <td><code>message</code></td>
                <td>string</td>
                <td>Message text</td>
              </tr>
              <tr>
                <td><code>timestamp</code></td>
                <td>date</td>
                <td>ISO timestamp</td>
              </tr>
              <tr>
                <td><code>requestId</code></td>
                <td>string</td>
                <td>Request ID (if in meta)</td>
              </tr>
              <tr>
                <td><code>userId</code></td>
                <td>string</td>
                <td>User ID (if in meta)</td>
              </tr>
              <tr>
                <td><code>traceId</code></td>
                <td>string</td>
                <td>Trace ID (if in meta)</td>
              </tr>
            </tbody>
          </table>

          <h3>Loki Log Format</h3>
          <table class="fields-table">
            <thead>
              <tr>
                <th>Field</th>
                <th>Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>line</code></td>
                <td>string</td>
                <td>Log line (alias for message)</td>
              </tr>
              <tr>
                <td><code>labels</code></td>
                <td>string</td>
                <td>Log labels</td>
              </tr>
              <tr>
                <td><code>job</code></td>
                <td>string</td>
                <td>Job name</td>
              </tr>
              <tr>
                <td><code>instance</code></td>
                <td>string</td>
                <td>Instance name</td>
              </tr>
              <tr>
                <td><code>app</code></td>
                <td>string</td>
                <td>Application name</td>
              </tr>
            </tbody>
          </table>

          <h3>Docker Log Format</h3>
          <table class="fields-table">
            <thead>
              <tr>
                <th>Field</th>
                <th>Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>log</code></td>
                <td>string</td>
                <td>Log line (alias for message)</td>
              </tr>
              <tr>
                <td><code>stream</code></td>
                <td>string</td>
                <td>Stream type (stdout/stderr)</td>
              </tr>
              <tr>
                <td><code>time</code></td>
                <td>date</td>
                <td>Timestamp</td>
              </tr>
            </tbody>
          </table>

          <h3>Promtail Log Format</h3>
          <table class="fields-table">
            <thead>
              <tr>
                <th>Field</th>
                <th>Type</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>message</code></td>
                <td>string</td>
                <td>Message text</td>
              </tr>
              <tr>
                <td><code>level</code></td>
                <td>string</td>
                <td>Log level</td>
              </tr>
              <tr>
                <td><code>ts</code></td>
                <td>date</td>
                <td>Timestamp</td>
              </tr>
            </tbody>
          </table>
        </div>
      </mat-tab>

      <!-- Examples Tab -->
      <mat-tab label="Examples">
        <div class="tab-content">
          <h3>Common Use Cases</h3>

          <div class="example-group">
            <h4>Find Errors</h4>
            <code>level=error</code>
            <p class="description">All error logs</p>

            <code>level=error AND environment=prod</code>
            <p class="description">Production errors only</p>

            <code>message.contains(exception)</code>
            <p class="description">Logs containing "exception"</p>
          </div>

          <div class="example-group">
            <h4>API Issues</h4>
            <code>message.contains(api) AND level=error</code>
            <p class="description">API-related errors</p>

            <code>statusCode&gt;=500</code>
            <p class="description">Server errors (5xx status codes)</p>

            <code>message.matches(/api.*timeout/i)</code>
            <p class="description">API timeout errors (regex)</p>
          </div>

          <div class="example-group">
            <h4>Time Ranges</h4>
            <code>timestamp&gt;="2024-12-01" AND timestamp&lt;"2024-12-07"</code>
            <p class="description">Logs within date range</p>

            <code>timestamp&gt;"2024-12-05T10:00:00"</code>
            <p class="description">Logs after specific time</p>
          </div>

          <div class="example-group">
            <h4>Complex Filters</h4>
            <code>(level=error OR level=fatal) AND message.matches(/database|connection/)</code>
            <p class="description">Critical logs with database/connection issues</p>

            <code>level=warn AND message.contains(retry) AND NOT message.contains(success)</code>
            <p class="description">Failed retry attempts</p>

            <code>level=error AND environment=prod AND message.contains(api)</code>
            <p class="description">Production API errors</p>
          </div>

          <div class="example-group">
            <h4>HTTP Requests</h4>
            <code>(statusCode&gt;=500 OR statusCode=404) AND method=GET</code>
            <p class="description">Failed GET requests</p>

            <code>statusCode&gt;=400 AND url.startsWith("/api")</code>
            <p class="description">API request failures</p>
          </div>

          <div class="example-group">
            <h4>Service-Specific</h4>
            <code>hostname.startsWith(web) AND level!=debug</code>
            <p class="description">Non-debug logs from web servers</p>

            <code>hostname.contains(api) AND message.matches(/timeout/i)</code>
            <p class="description">Timeout issues in API services</p>
          </div>
        </div>
      </mat-tab>

      <!-- Regex Guide Tab -->
      <mat-tab label="Regex Guide">
        <div class="tab-content">
          <h3>Regular Expression Patterns</h3>
          <p>Use regex patterns with the <code>matches()</code> function for advanced text matching.</p>

          <h4>Basic Patterns</h4>
          <table class="regex-table">
            <thead>
              <tr>
                <th>Pattern</th>
                <th>Description</th>
                <th>Example</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>.</code></td>
                <td>Any single character</td>
                <td><code>/er.or/</code> matches "error"</td>
              </tr>
              <tr>
                <td><code>*</code></td>
                <td>Zero or more of preceding</td>
                <td><code>/er*or/</code> matches "eor" or "error"</td>
              </tr>
              <tr>
                <td><code>+</code></td>
                <td>One or more of preceding</td>
                <td><code>/er+or/</code> matches "error" but not "eor"</td>
              </tr>
              <tr>
                <td><code>?</code></td>
                <td>Zero or one of preceding</td>
                <td><code>/colou?r/</code> matches "color" or "colour"</td>
              </tr>
              <tr>
                <td><code>|</code></td>
                <td>Alternation (OR)</td>
                <td><code>/error|warning/</code> matches "error" or "warning"</td>
              </tr>
            </tbody>
          </table>

          <h4>Character Classes</h4>
          <table class="regex-table">
            <thead>
              <tr>
                <th>Pattern</th>
                <th>Description</th>
                <th>Example</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>\d</code></td>
                <td>Any digit (0-9)</td>
                <td><code>/\d{3}/</code> matches "404", "500"</td>
              </tr>
              <tr>
                <td><code>\w</code></td>
                <td>Word character (a-z, A-Z, 0-9, _)</td>
                <td><code>/\w+/</code> matches "error", "api_timeout"</td>
              </tr>
              <tr>
                <td><code>\s</code></td>
                <td>Whitespace character</td>
                <td><code>/error\s+code/</code> matches "error code"</td>
              </tr>
              <tr>
                <td><code>[abc]</code></td>
                <td>Any of: a, b, or c</td>
                <td><code>/[aeiou]/</code> matches any vowel</td>
              </tr>
              <tr>
                <td><code>[^abc]</code></td>
                <td>Not a, b, or c</td>
                <td><code>/[^0-9]/</code> matches non-digits</td>
              </tr>
            </tbody>
          </table>

          <h4>Anchors</h4>
          <table class="regex-table">
            <thead>
              <tr>
                <th>Pattern</th>
                <th>Description</th>
                <th>Example</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>^</code></td>
                <td>Start of string</td>
                <td><code>/^ERROR/</code> matches lines starting with "ERROR"</td>
              </tr>
              <tr>
                <td><code>$</code></td>
                <td>End of string</td>
                <td><code>/failed$/</code> matches lines ending with "failed"</td>
              </tr>
            </tbody>
          </table>

          <h4>Quantifiers</h4>
          <table class="regex-table">
            <thead>
              <tr>
                <th>Pattern</th>
                <th>Description</th>
                <th>Example</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>&#123;'&#123;n&#125;'&#125;</code></td>
                <td>Exactly n times</td>
                <td><code>/\d{'{3}'}/</code> matches exactly 3 digits</td>
              </tr>
              <tr>
                <td><code>{'{n,}'}</code></td>
                <td>n or more times</td>
                <td><code>/\d{'{2,}'}/</code> matches 2 or more digits</td>
              </tr>
              <tr>
                <td><code>{'{n,m}'}</code></td>
                <td>Between n and m times</td>
                <td><code>/\d{'{2,4}'}/</code> matches 2-4 digits</td>
              </tr>
            </tbody>
          </table>

          <h4>Flags</h4>
          <table class="regex-table">
            <thead>
              <tr>
                <th>Flag</th>
                <th>Description</th>
                <th>Example</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td><code>i</code></td>
                <td>Case-insensitive</td>
                <td><code>/error/i</code> matches "ERROR", "Error", "error"</td>
              </tr>
              <tr>
                <td><code>g</code></td>
                <td>Global (find all matches)</td>
                <td><code>/error/g</code> finds all occurrences</td>
              </tr>
            </tbody>
          </table>

          <h4>Practical Examples</h4>
          <div class="example-group">
            <code>message.matches(/timeout/i)</code>
            <p class="description">Case-insensitive search for "timeout"</p>

            <code>message.matches(/\d{3}\s+error/)</code>
            <p class="description">3 digits followed by whitespace and "error"</p>

            <code>message.matches(/^ERROR.*timeout$/)</code>
            <p class="description">Lines starting with "ERROR" and ending with "timeout"</p>

            <code>message.matches(/api|database|connection/)</code>
            <p class="description">Match "api", "database", or "connection"</p>

            <code>message.matches(/error\s+code:\s+\d+/i)</code>
            <p class="description">Match "error code: 404" pattern</p>
          </div>

          <p class="note">
            <strong>Performance Tip:</strong> Regex queries are slower than simple comparisons. When possible, combine
            regex with field filters to narrow results first: <code>level=error AND message.matches(/pattern/)</code>
          </p>
        </div>
      </mat-tab>

      <!-- Performance Tips Tab -->
      <mat-tab label="Performance">
        <div class="tab-content">
          <h3>Query Optimization Tips</h3>

          <div class="tip-group">
            <h4>1. Use Indexed Fields First</h4>
            <p>
              Queries on <code>level</code> and <code>environment</code> are fastest (O(1) lookup). Start with these
              fields when possible.
            </p>
            <div class="examples">
              <div class="good">
                <strong>✓ Good:</strong> <code>level=error AND message.contains(api)</code>
              </div>
              <div class="bad">
                <strong>✗ Slow:</strong> <code>message.contains(api) AND level=error</code>
              </div>
            </div>
          </div>

          <div class="tip-group">
            <h4>2. Narrow Before Regex</h4>
            <p>Regex queries require full scans. Filter with simpler conditions first to reduce the dataset.</p>
            <div class="examples">
              <div class="good">
                <strong>✓ Good:</strong> <code>level=error AND message.matches(/timeout/i)</code>
              </div>
              <div class="bad">
                <strong>✗ Slow:</strong> <code>message.matches(/timeout/i)</code>
              </div>
            </div>
          </div>

          <div class="tip-group">
            <h4>3. Use Simple Functions When Possible</h4>
            <p>
              <code>contains()</code>, <code>startsWith()</code>, and <code>endsWith()</code> are faster than regex.
            </p>
            <div class="examples">
              <div class="good">
                <strong>✓ Good:</strong> <code>message.contains(timeout)</code>
              </div>
              <div class="bad">
                <strong>✗ Slower:</strong> <code>message.matches(/timeout/)</code>
              </div>
            </div>
          </div>

          <div class="tip-group">
            <h4>4. Quote Multi-Word Strings</h4>
            <p>Use quotes for phrases to ensure proper parsing.</p>
            <div class="examples">
              <div class="good">
                <strong>✓ Good:</strong> <code>message.contains("connection timeout")</code>
              </div>
              <div class="bad">
                <strong>✗ Error:</strong> <code>message.contains(connection timeout)</code>
              </div>
            </div>
          </div>

          <div class="tip-group">
            <h4>5. Use Parentheses for Complex Logic</h4>
            <p>Group conditions clearly to avoid ambiguity and improve readability.</p>
            <div class="examples">
              <div class="good">
                <strong>✓ Good:</strong> <code>(level=error OR level=fatal) AND environment=prod</code>
              </div>
            </div>
          </div>

          <h3>Performance Characteristics</h3>
          <table class="performance-table">
            <thead>
              <tr>
                <th>Query Type</th>
                <th>Performance (200k entries)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Simple indexed query (e.g., <code>level=error</code>)</td>
                <td>&lt; 50ms</td>
              </tr>
              <tr>
                <td>Complex multi-clause query</td>
                <td>&lt; 500ms</td>
              </tr>
              <tr>
                <td>Regex query (full scan)</td>
                <td>&lt; 1000ms</td>
              </tr>
              <tr>
                <td>Cached query (repeat search)</td>
                <td>&lt; 5ms</td>
              </tr>
            </tbody>
          </table>

          <p class="note">
            <strong>Note:</strong> Queries are executed in a Web Worker thread, keeping the UI responsive even for
            complex searches on large datasets.
          </p>
        </div>
      </mat-tab>
    </mat-tab-group>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button (click)="close()">Close</button>
  </mat-dialog-actions>
</div>

