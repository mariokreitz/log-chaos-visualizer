<mat-form-field>
	<mat-label>Filter</mat-label>
	<input #filterInput [formControl]="filterControl" aria-label="Filter logs" matInput placeholder="Filter logs" />
	@if (filterControl.value) {
		<button (click)="clearFilter()" aria-label="Clear filter" mat-icon-button matSuffix>
			<mat-icon>close</mat-icon>
		</button>
	}
</mat-form-field>

<div aria-label="Parsed log entries table" class="mat-elevation-z8 analyse-table" role="table">
	<!-- Static header kept outside the virtual viewport for accessibility -->
	<div class="table-header" role="rowgroup">
		<div class="table-header-row" role="row">
			<div class="col kind" role="columnheader">Kind</div>
			<div class="col timestamp" role="columnheader">Timestamp</div>
			<div class="col level" role="columnheader">Level</div>
			<div class="col message" role="columnheader">Message</div>
			<div class="col source" role="columnheader">Source</div>
		</div>
	</div>

	<div aria-live="polite" class="table-toolbar">
    <span class="count">
      Showing {{ entries().length }} entries
			@if (lastSearchDurationMs() !== null && lastSearchResultCount() !== null) {
				<span class="search-meta">
          &mdash; last search: {{ lastSearchResultCount() }} results in
					{{ lastSearchDurationMs() | number: '1.0-0' }} ms
        </span>
			}
    </span>
		@if (isSearching()) {
			<mat-progress-spinner
						aria-label="Searching logs"
						class="search-spinner"
						diameter="20"
						mode="indeterminate"
			></mat-progress-spinner>
		}
	</div>

	<cdk-virtual-scroll-viewport aria-label="Log entries viewport" class="viewport" itemSize="48" role="rowgroup">
		@for (row of entries(); track row.entry) {
			<div class="table-row" role="row" tabindex="0">
				<div class="col kind" role="cell">{{ row.kind }}</div>
				<div class="col timestamp" role="cell">{{ formatTimestamp(row) }}</div>
				<div class="col level" role="cell">{{ formatLevel(row) }}</div>
				<div class="col message" role="cell">{{ formatMessage(row) }}</div>
				<div class="col source" role="cell">{{ formatSource(row) }}</div>
			</div>
		}

		@if (entries().length === 0 && !isSearching()) {
			<div class="no-data" role="row">
				<div class="mat-cell" role="cell">No data matching the filter "{{ filterInput.value }}"</div>
			</div>
		}
	</cdk-virtual-scroll-viewport>
</div>
