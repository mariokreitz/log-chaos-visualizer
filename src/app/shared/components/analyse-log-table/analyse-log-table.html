<app-search-input
  (clear)="onSearchClear()"
  (valueChange)="onSearchInput($event)"
  [isSearching]="isSearching()"
  [value]="searchQuery()"
  ariaLabel="Search through log entries"
  placeholder="Search logs..."
></app-search-input>

<div aria-label="Parsed log entries table" class="mat-elevation-z8 analyse-table" role="table">
  <div class="table-header" role="rowgroup">
    <div class="table-header-row" role="row">
      <div class="col kind" role="columnheader">Kind</div>
      <div class="col timestamp" role="columnheader">Timestamp</div>
      <div class="col level" role="columnheader">Level</div>
      <div class="col message" role="columnheader">Message</div>
      <div class="col source" role="columnheader">Source</div>
    </div>
  </div>

  <div aria-live="polite" class="table-toolbar">
    <span class="count">
      Showing {{ entries().length }} entries
      @if (lastSearchDurationMs() !== null && lastSearchResultCount() !== null) {
        <span class="search-meta">
          &mdash; last search: {{ lastSearchResultCount() }} results in
          {{ lastSearchDurationMs() | number: '1.0-0' }} ms
        </span>
      }
    </span>
  </div>

  <cdk-virtual-scroll-viewport aria-label="Log entries viewport" class="viewport" itemSize="48" role="rowgroup">
    @for (row of entries(); track row.entry) {
      <div class="table-row" role="row" tabindex="0">
        <div class="col kind" role="cell">{{ row.kind }}</div>
        <div class="col timestamp" role="cell">{{ formatTimestamp(row) }}</div>
        <div class="col level" role="cell">{{ formatLevel(row) }}</div>
        <div class="col message" role="cell">{{ formatMessage(row) }}</div>
        <div class="col source" role="cell">{{ formatSource(row) }}</div>
      </div>
    }

    @if (entries().length === 0 && !isSearching()) {
      <div class="no-data" role="row">
        <div class="mat-cell" role="cell">No data matching the filter "{{ searchQuery() }}"</div>
      </div>
    }
  </cdk-virtual-scroll-viewport>
</div>
