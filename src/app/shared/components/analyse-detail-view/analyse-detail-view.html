@let e = entry();
@if (e) {
  <article [attr.aria-labelledby]="headingId()" class="detail-container" role="region" tabindex="-1">
    <header class="detail-header">
      <div class="summary-left">
        <div [id]="headingId()" class="summary-title">
          <div class="message" title="{{ messageText() || 'No message' }}">
            {{ (messageText() || 'No message').slice(0, 200) }}{{ (messageText() || '').length > 200 ? '\u2026' : '' }}
          </div>
          <div class="meta-small">
            <span class="ts" title="{{ formattedTimestamp() }}">{{ formattedTimestamp() }}</span>
            <span aria-hidden="true" class="divider">\u2022</span>
            <span class="kind">{{ e.kind }}</span>
          </div>
        </div>
        <div aria-label="Entry metadata" class="summary-chips" role="list">
          <span aria-label="Level {{ e.normalized.level }}" class="mat-chip level" role="listitem">{{
            e.normalized.level
          }}</span>
          <span aria-label="Environment {{ e.normalized.environment }}" class="mat-chip env" role="listitem">{{
            e.normalized.environment
          }}</span>
          <span aria-label="Source {{ e.normalized.kind }}" class="mat-chip source" role="listitem">{{
            e.normalized.kind
          }}</span>
        </div>
        @if (hasStack() && !showStack() && !showRaw()) {
          <pre aria-hidden="true" class="stack-preview">{{ stackPreview() }}</pre>
        }
      </div>
      <div class="summary-actions">
        @if (hasStack()) {
          <div
            (click)="toggleStack()"
            (keyup)="($event.key === 'Enter' || $event.key === ' ') && toggleStack()"
            [attr.aria-expanded]="showStack()"
            aria-controls="stack-panel"
            class="stack-toggle"
            role="button"
            tabindex="0"
            title="Toggle stack preview"
          >
            <mat-icon aria-hidden="true">expand_more</mat-icon>
            <span class="stack-toggle-label">{{ showStack() ? 'Hide details' : 'Show details' }}</span>
          </div>
        }
      </div>
    </header>
    <section aria-label="Log details" class="detail-grid">
      <div class="panel panel-main">
        <!-- Main log details go here -->
        <dl>
          <dt>Message</dt>
          <dd>{{ messageText() }}</dd>
          <dt>Timestamp</dt>
          <dd>{{ formattedTimestamp() }}</dd>
          <dt>Level</dt>
          <dd>{{ e.normalized.level }}</dd>
          <dt>Environment</dt>
          <dd>{{ e.normalized.environment }}</dd>
          <dt>Source</dt>
          <dd>{{ e.normalized.kind }}</dd>
        </dl>
        @if (showStack()) {
          <pre class="stack-full" id="stack-panel" tabindex="0">{{ stackFull() }}</pre>
        }
        @if (showRaw()) {
          <pre class="raw-json" tabindex="0">{{ rawJson() }}</pre>
        }
      </div>
    </section>
  </article>
} @else {
  <div class="detail-empty">No entry selected</div>
}
