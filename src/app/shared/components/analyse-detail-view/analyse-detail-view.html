@let e = entry();
@if (e) {
  @let h = httpInfo();
  <article aria-labelledby="detail-summary" class="detail-container" tabindex="-1">
    <header class="detail-header">
      <div class="summary-left">
        <div class="summary-title" id="detail-summary">
          <div class="message">{{ messageText() || 'No message' }}</div>
          <div class="meta-small">
            <span class="ts" title="{{ formattedTimestamp() }}">{{ formattedTimestamp() }}</span>
            <span class="divider">â€¢</span>
            <span class="kind">{{ e.kind }}</span>
          </div>
        </div>
        <div class="summary-chips">
          <span aria-label="Level {{ e.normalized.level }}" class="chip level">{{ e.normalized.level }}</span>
          <span aria-label="Environment {{ e.normalized.environment }}" class="chip env">{{
            e.normalized.environment
          }}</span>
          <span aria-label="Source {{ e.normalized.kind }}" class="chip source">{{ e.normalized.kind }}</span>
        </div>
      </div>
    </header>

    <section aria-label="Log details" class="detail-grid">
      <div class="panel panel-main">
        <h3 class="panel-title">Details</h3>
        <dl class="meta-list">
          @for (pair of normalizedEntries(); track $index) {
            <div class="meta-row">
              <dt class="meta-key">{{ pair[0] }}</dt>
              <dd class="meta-value">{{ pair[1] }}</dd>
            </div>
          }
        </dl>
      </div>

      <div class="panel panel-context">
        <h3 class="panel-title">Context</h3>
        @if (h) {
          <div class="http">
            <div><strong>Method:</strong> {{ h.method ?? '-' }}</div>
            <div>
              <strong>URL:</strong> <code>{{ h.url ?? '-' }}</code>
            </div>
            <div><strong>Status:</strong> {{ h.statusCode ?? '-' }}</div>
            <div><strong>Response time:</strong> {{ h.responseTime ?? '-' }} ms</div>
          </div>
        } @else {
          <div class="no-context">No structured HTTP context</div>
        }

        @if (metaEntries().length > 0) {
          <div class="tags">
            <h4>Metadata</h4>
            <div class="tags-wrap">
              @for (pair of metaEntries(); track $index) {
                <span class="tag">{{ pair[0] }}: {{ pair[1] }}</span>
              }
            </div>
          </div>
        }
      </div>
    </section>

    @if (hasStack()) {
      <section aria-label="Stack trace" class="panel panel-stack">
        <h3 class="panel-title">Stack trace</h3>
        @if (showStack()) {
          <pre class="stack-full">{{ stackText() ?? rawJson }}</pre>
        } @else {
          <pre class="stack-preview">{{ stackPreview() }}</pre>
        }
      </section>
    }
  </article>
} @else {
  <div class="detail-empty">No entry selected</div>
}
